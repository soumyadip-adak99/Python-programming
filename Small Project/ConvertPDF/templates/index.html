<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Tools - iLovePDF Style</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1 class="logo">üìÑ PDF Tools</h1>
            <p class="tagline">All-in-one PDF solution</p>
        </header>

        <!-- Tool Selection -->
        <div class="tools-grid" id="toolsGrid">
            <div class="tool-card" data-tool="convert" onclick="selectTool('convert')">
                <div class="tool-icon">üì•</div>
                <h3>Convert to PDF</h3>
                <p>Images, Word, Excel, PPT</p>
            </div>
            <div class="tool-card" data-tool="merge" onclick="selectTool('merge')">
                <div class="tool-icon">üîó</div>
                <h3>Merge PDFs</h3>
                <p>Combine multiple PDFs</p>
            </div>
            <div class="tool-card" data-tool="split" onclick="selectTool('split')">
                <div class="tool-icon">‚úÇÔ∏è</div>
                <h3>Split PDF</h3>
                <p>Extract specific pages</p>
            </div>
            <div class="tool-card" data-tool="compress" onclick="selectTool('compress')">
                <div class="tool-icon">üì¶</div>
                <h3>Compress PDF</h3>
                <p>Reduce file size</p>
            </div>
            <div class="tool-card" data-tool="rotate" onclick="selectTool('rotate')">
                <div class="tool-icon">üîÑ</div>
                <h3>Rotate PDF</h3>
                <p>Rotate pages</p>
            </div>
            <div class="tool-card" data-tool="pdf-to-image" onclick="selectTool('pdf-to-image')">
                <div class="tool-icon">üñºÔ∏è</div>
                <h3>PDF to Image</h3>
                <p>Convert to JPG/PNG</p>
            </div>
        </div>

        <!-- Tool Interface -->
        <div class="tool-interface" id="toolInterface" style="display: none;">
            <button class="back-btn" onclick="goBack()">‚Üê Back to Tools</button>

            <div class="tool-header">
                <h2 id="toolTitle">Convert to PDF</h2>
                <p id="toolDescription">Upload your file to convert</p>
            </div>

            <!-- Upload Area -->
            <div class="upload-box" id="uploadBox">
                <div class="upload-icon">üìÅ</div>
                <p>Drag & drop your file(s) here</p>
                <span>or click to browse</span>
                <input type="file" id="fileInput" hidden>
            </div>

            <!-- File List -->
            <div class="file-list" id="fileList"></div>

            <!-- Options Panel -->
            <div class="options-panel" id="optionsPanel" style="display: none;">
                <!-- Split Options -->
                <div class="option-group" id="splitOptions" style="display: none;">
                    <label>Pages to extract:</label>
                    <input type="text" id="pagesInput" placeholder="e.g., 1,3,5-7" class="text-input">
                    <small>Use commas for individual pages, dashes for ranges</small>
                </div>

                <!-- Compress Options -->
                <div class="option-group" id="compressOptions" style="display: none;">
                    <label>Compression Level:</label>
                    <select id="qualitySelect" class="select-input">
                        <option value="high">High Quality (Less Compression)</option>
                        <option value="medium" selected>Balanced</option>
                        <option value="low">Maximum Compression</option>
                    </select>
                </div>

                <!-- Rotate Options -->
                <div class="option-group" id="rotateOptions" style="display: none;">
                    <label>Rotation Angle:</label>
                    <select id="angleSelect" class="select-input">
                        <option value="90">90¬∞ Clockwise</option>
                        <option value="180">180¬∞</option>
                        <option value="270">90¬∞ Counter-clockwise</option>
                    </select>
                </div>

                <!-- PDF to Image Options -->
                <div class="option-group" id="imageOptions" style="display: none;">
                    <label>Image Format:</label>
                    <select id="formatSelect" class="select-input">
                        <option value="jpg">JPG</option>
                        <option value="png">PNG</option>
                    </select>
                </div>
            </div>

            <!-- Action Button -->
            <button class="action-btn" id="actionBtn" disabled onclick="processFiles()">
                <span id="actionText">Process</span>
            </button>

            <!-- Progress -->
            <div class="progress-box" id="progressBox" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <span id="progressText">Processing...</span>
            </div>

            <!-- Result -->
            <div class="result-box" id="resultBox" style="display: none;">
                <div class="result-icon">‚úì</div>
                <p id="resultMessage">Done!</p>
                <a class="download-btn" id="downloadBtn" href="#">Download</a>
                <button class="reset-btn" onclick="resetTool()">Process Another</button>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Supported: PNG, JPG, GIF, BMP, WebP, TXT, DOCX, HTML, XLSX, PPTX, PDF</p>
        </footer>
    </div>

    <script>
        let currentTool = null;
        let selectedFiles = [];

        const toolConfig = {
            'convert': {
                title: 'Convert to PDF',
                description: 'Upload images, documents to convert to PDF',
                accept: '.png,.jpg,.jpeg,.gif,.bmp,.webp,.txt,.docx,.html,.xlsx,.xls,.pptx,.ppt',
                multiple: false,
                endpoint: '/api/convert',
                action: 'Convert'
            },
            'merge': {
                title: 'Merge PDFs',
                description: 'Upload multiple PDF files to merge',
                accept: '.pdf',
                multiple: true,
                endpoint: '/api/merge',
                action: 'Merge PDFs',
                minFiles: 2
            },
            'split': {
                title: 'Split PDF',
                description: 'Extract specific pages from your PDF',
                accept: '.pdf',
                multiple: false,
                endpoint: '/api/split',
                action: 'Split PDF',
                options: 'splitOptions'
            },
            'compress': {
                title: 'Compress PDF',
                description: 'Reduce PDF file size',
                accept: '.pdf',
                multiple: false,
                endpoint: '/api/compress',
                action: 'Compress',
                options: 'compressOptions'
            },
            'rotate': {
                title: 'Rotate PDF',
                description: 'Rotate all pages in your PDF',
                accept: '.pdf',
                multiple: false,
                endpoint: '/api/rotate',
                action: 'Rotate',
                options: 'rotateOptions'
            },
            'pdf-to-image': {
                title: 'PDF to Image',
                description: 'Convert PDF pages to images',
                accept: '.pdf',
                multiple: false,
                endpoint: '/api/pdf-to-image',
                action: 'Convert to Images',
                options: 'imageOptions'
            }
        };

        function selectTool(tool) {
            currentTool = tool;
            const config = toolConfig[tool];

            document.getElementById('toolsGrid').style.display = 'none';
            document.getElementById('toolInterface').style.display = 'block';

            document.getElementById('toolTitle').textContent = config.title;
            document.getElementById('toolDescription').textContent = config.description;
            document.getElementById('actionText').textContent = config.action;

            const fileInput = document.getElementById('fileInput');
            fileInput.accept = config.accept;
            fileInput.multiple = config.multiple || false;

            // Hide all options
            document.querySelectorAll('.option-group').forEach(el => el.style.display = 'none');
            document.getElementById('optionsPanel').style.display = 'none';

            // Show relevant options
            if (config.options) {
                document.getElementById('optionsPanel').style.display = 'block';
                document.getElementById(config.options).style.display = 'block';
            }

            resetTool();
        }

        function goBack() {
            document.getElementById('toolsGrid').style.display = 'grid';
            document.getElementById('toolInterface').style.display = 'none';
            currentTool = null;
            selectedFiles = [];
        }

        // Upload box events
        const uploadBox = document.getElementById('uploadBox');
        const fileInput = document.getElementById('fileInput');

        uploadBox.addEventListener('click', () => fileInput.click());

        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.classList.add('dragover');
        });

        uploadBox.addEventListener('dragleave', () => {
            uploadBox.classList.remove('dragover');
        });

        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            const config = toolConfig[currentTool];

            if (config.multiple) {
                for (let file of files) {
                    selectedFiles.push(file);
                }
            } else {
                selectedFiles = [files[0]];
            }

            updateFileList();
            updateActionButton();
        }

        function updateFileList() {
            const fileList = document.getElementById('fileList');

            if (selectedFiles.length === 0) {
                fileList.innerHTML = '';
                return;
            }

            fileList.innerHTML = selectedFiles.map((file, index) => `
                <div class="file-item">
                    <span class="file-name">${file.name}</span>
                    <span class="file-size">${formatSize(file.size)}</span>
                    <button class="remove-file" onclick="removeFile(${index})">‚úï</button>
                </div>
            `).join('');
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
            updateActionButton();
        }

        function updateActionButton() {
            const config = toolConfig[currentTool];
            const btn = document.getElementById('actionBtn');

            if (config.minFiles) {
                btn.disabled = selectedFiles.length < config.minFiles;
            } else {
                btn.disabled = selectedFiles.length === 0;
            }
        }

        function formatSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        async function processFiles() {
            const config = toolConfig[currentTool];

            document.getElementById('actionBtn').style.display = 'none';
            document.getElementById('uploadBox').style.display = 'none';
            document.getElementById('fileList').innerHTML = '';
            document.getElementById('optionsPanel').style.display = 'none';
            document.getElementById('progressBox').style.display = 'block';

            const formData = new FormData();

            if (config.multiple) {
                selectedFiles.forEach(file => formData.append('files', file));
            } else {
                formData.append('file', selectedFiles[0]);
            }

            // Add options
            if (currentTool === 'split') {
                formData.append('pages', document.getElementById('pagesInput').value || '1');
            } else if (currentTool === 'compress') {
                formData.append('quality', document.getElementById('qualitySelect').value);
            } else if (currentTool === 'rotate') {
                formData.append('angle', document.getElementById('angleSelect').value);
            } else if (currentTool === 'pdf-to-image') {
                formData.append('format', document.getElementById('formatSelect').value);
            }

            try {
                // Animate progress
                let progress = 0;
                const progressFill = document.getElementById('progressFill');
                const interval = setInterval(() => {
                    progress += Math.random() * 15;
                    if (progress > 90) progress = 90;
                    progressFill.style.width = progress + '%';
                }, 200);

                const response = await fetch(config.endpoint, {
                    method: 'POST',
                    body: formData
                });

                clearInterval(interval);
                progressFill.style.width = '100%';

                const data = await response.json();

                if (data.success) {
                    setTimeout(() => {
                        document.getElementById('progressBox').style.display = 'none';
                        document.getElementById('resultBox').style.display = 'block';
                        document.getElementById('resultMessage').textContent = data.message;
                        document.getElementById('downloadBtn').href = data.download_url;
                    }, 300);
                } else {
                    throw new Error(data.error || 'Processing failed');
                }
            } catch (error) {
                document.getElementById('progressBox').style.display = 'none';
                alert('Error: ' + error.message);
                resetTool();
            }
        }

        function resetTool() {
            selectedFiles = [];
            document.getElementById('fileInput').value = '';
            document.getElementById('fileList').innerHTML = '';
            document.getElementById('uploadBox').style.display = 'flex';
            document.getElementById('actionBtn').style.display = 'block';
            document.getElementById('actionBtn').disabled = true;
            document.getElementById('progressBox').style.display = 'none';
            document.getElementById('resultBox').style.display = 'none';
            document.getElementById('progressFill').style.width = '0%';

            const config = toolConfig[currentTool];
            if (config && config.options) {
                document.getElementById('optionsPanel').style.display = 'block';
                document.getElementById(config.options).style.display = 'block';
            }
        }
    </script>
</body>

</html>